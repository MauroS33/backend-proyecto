<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Productos</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <h1>Lista de Productos</h1>

  <!-- Contenedor de Productos -->
  <div id="product-list">
    {{#each products}}
      <div>
        <h3>{{this.title}}</h3>
        <p>Precio: ${{this.price}}</p>
        <button onclick="addToCart('{{this._id}}')">Agregar al Carrito</button>
      </div>
    {{/each}}
  </div>

  <!-- Botón para ir al carrito -->
  <a href="/cart?cartId={{cartId}}">Ir al Carrito</a>

  <!-- Paginación -->
  <div id="pagination">
    <button id="prev-page" {{#ifCond currentPage 1}}disabled{{/ifCond}}>Anterior</button>
    <span>Página {{currentPage}} de {{totalPages}}</span>
    <button id="next-page" {{#ifCond currentPage totalPages}}disabled{{/ifCond}}>Siguiente</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    let currentPage = {{currentPage}};
    const limit = 10;

    // Función para cargar productos paginados
    async function loadProducts(page) {
      window.location.href = `/products?page=${page}&limit=${limit}`;
    }

    // Función para agregar un producto al carrito
    async function addToCart(productId) {
      const cartId = "{{cartId}}"; // Obtener ID del carrito desde la vista
      const quantity = 1;

      try {
        const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ quantity })
        });

        if (!response.ok) throw new Error("Error al agregar producto al carrito");

        alert("Producto agregado al carrito exitosamente");
      } catch (error) {
        console.error(error.message);
        alert("Ocurrió un error al agregar el producto");
      }
    }
  </script>
</body>
</html>